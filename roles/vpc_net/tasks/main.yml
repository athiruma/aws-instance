---

- name: Create VPC in {{region}}
  amazon.aws.ec2_vpc_net: 
   region: "{{region }}"
   name: "{{ vpc_name }}"
   cidr_block: "{{ cidr_block }}"
   tenancy: dedicated
  register: vpc 

- name: Create Subnet
  amazon.aws.ec2_vpc_subnet:
   region: "{{ region }}"
   vpc_id: "{{ vpc.id }}"
   cidr: "{{ cidr_subnet1 }}"
   az: "{{ zone }}"
  register: subnet

- name: create internet gateway
  amazon.aws.ec2_vpc_igw:
   region: "{{ region }}"
   vpc_id: "{{ vpc.id }}"
  register: igw

- name: Set up public subnet route table
  amazon.aws.ec2_vpc_route_table:
   region: "{{region}}"
   vpc_id: "{{ vpc.id }}"
   subnets:
    - "{{ subnet.subnet_id  }}"
   routes:
    - dest: 0.0.0.0/0
      gateway_id: "{{ igw.gateway_id }}"
